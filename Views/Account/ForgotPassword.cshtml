@model QLNSVATC.Models.ForgotPasswordViewModel
@{

    ViewBag.Title = "Forgot Password";
    Layout = "~/Views/Shared/_LayoutGuest.cshtml";
}

<style>
    @@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    @@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap');

    .login-wrapper {
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .login-container {
        width: 100%;
        max-width: 500px;
        padding: 120px 0;
        display: flex;
        justify-content: center;
    }

    .gold-box {
        position: relative;
        padding: 28px 32px;
        border-radius: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        width: auto;
        height: auto;
    }

        .gold-box::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 20px;
            background: linear-gradient(135deg, #f9d976 0%, #f39f33 100%);
            filter: blur(18px);
            z-index: -2;
        }

        .gold-box::after {
            content: '';
            position: absolute;
            inset: -4px;
            background: linear-gradient(135deg, #f3b625, #c27a12, #f6d56c, #6b4e18);
            background-size: 300%;
            border-radius: 20px;
            z-index: -1;
            animation: goldMove 4s linear infinite;
        }

    @@keyframes goldMove {
        0% {
            background-position: 0%;
        }

        100% {
            background-position: 300%;
        }
    }

    .gold-inner {
        width: 100%;
        background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
        border-radius: 15px;
        padding: 26px 32px;
        display: flex;
        flex-direction: column;
        align-items: center;
        box-shadow: inset 0 0 15px rgba(255,215,0,0.15), 0 0 25px rgba(255,215,0,0.10);
        color: #ffd26a;
        transition: 0.6s;
    }

    .login-form {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 15px;
        text-align: center;
    }

    .gold-input {
        width: 100%;
        padding: 10px 18px;
        border-radius: 12px;
        background: rgba(255,214,94,0.08);
        border: 1px solid rgba(255,214,94,0.3);
        color: #ffdd8a;
        outline: none;
    }

    .gold-btn {
        width: 100%;
        padding: 10px 0;
        border-radius: 12px;
        border: none;
        font-weight: 600;
        cursor: pointer;
        background: linear-gradient(135deg, #fceabb, #f8b500);
        color: #1a1a1a;
        transition: .35s;
    }

    .validation-summary-errors {
        color: #ffffff;
        font-size: 14px;
        margin-bottom: 10px;
        list-style:none;
        text-align:center;
    }
        .validation-summary-errors ul,
        .validation-summary-errors li {
            list-style: none !important;
            padding-left: 0 !important;
            margin-left: 0 !important;
        }

</style>


<div class="login-wrapper">
    <div class="login-container">
        <div class="gold-box">
            <div class="gold-inner">
                <h2 style="text-align:center">FORGOT?</h2>

                @Html.ValidationSummary(true, "", new { @class = "validation-summary-errors" })

                @using (Html.BeginForm("ForgotPassword", "Account", FormMethod.Post, new { @class = "login-form" }))
                {
                    @Html.AntiForgeryToken()

                    <!-- STEP 1: USERNAME + EMAIL -->
                    if (!Model.ShowOtp && !Model.ShowReset && !Model.Success)
                    {
                        @Html.TextBoxFor(m => m.Username,
                            new { placeholder = "Username", @class = "gold-input" })

                        @Html.TextBoxFor(m => m.Email,
                            new { placeholder = "Email", type = "email", @class = "gold-input" })

                        <button class="gold-btn">Send OTP</button>
                    }

                    <!-- STEP 2: OTP -->
                    if (Model.ShowOtp)
                    {
                        <p>Enter the OTP sent to your email.</p>

                        @Html.TextBoxFor(m => m.OtpCode,
                            new { placeholder = "Enter OTP", @class = "gold-input" })

                        <button type="submit" formaction="/Account/ForgotPasswordOtp" class="gold-btn">
                            Verify OTP
                        </button>
                    }

                    <!-- STEP 3: RESET PASSWORD -->
                    if (Model.ShowReset)
                    {
                        @Html.PasswordFor(m => m.NewPass,
                            new { placeholder = "New Password", @class = "gold-input" })

                        @Html.PasswordFor(m => m.ConfirmPass,
                            new { placeholder = "Confirm Password", @class = "gold-input" })

                        <button type="submit" formaction="/Account/ResetPassword" class="gold-btn">
                            Reset Password
                        </button>
                    }

                    <!-- STEP 4: SUCCESS -->
                    if (Model.Success)
                    {
                        <div style="padding:12px;background:#9dff9d;color:#000;
                                    border-radius:10px;font-weight:600;">
                            Password changed successfully. Redirecting...
                        </div>

                        <script>
                            setTimeout(function () {
                                window.location.href = '/Account/Login?username=@Model.Username';
                            }, 2500);
                        </script>
                    }
                }
            </div>
        </div>
    </div>
</div>
