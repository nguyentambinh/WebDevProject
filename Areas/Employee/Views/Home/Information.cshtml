@model QLNSVATC.Models.HREmployeeInformationViewModel
@using QLNSVATC.Models

@{
    ViewBag.Title = "Information";
    Layout = "~/Areas/HR/Views/Shared/_LayoutHR.cshtml";

    var settings = ViewBag.Settings as UserViewBagModel;

    string themeColor = (settings != null && !string.IsNullOrEmpty(settings.ThemeHex))
                        ? settings.ThemeHex
                        : "#2563eb";

    string fontFamily = (settings != null && !string.IsNullOrEmpty(settings.FontFamily))
                        ? settings.FontFamily
                        : "system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";

    int fontSize = (settings != null && settings.FontSize > 0)
                    ? settings.FontSize
                    : 18;
    if (fontSize < 16) { fontSize = 16; }
    if (fontSize > 24) { fontSize = 24; }

    bool isDarkMode = settings != null ? settings.DarkMode : true;

    string pageBg = isDarkMode ? "#020617" : "#f5f5f5";
    string cardBg = isDarkMode ? "#0f172a" : "#ffffff";
    string borderColor = isDarkMode ? "#1f2937" : "#e5e7eb";
    string mainTextColor = isDarkMode ? "#e5e7eb" : "#111827";
    string subTextColor = isDarkMode ? "#9ca3af" : "#6b7280";
    string lightText = isDarkMode ? "#cbd5f5" : "#4b5563";

    var fullName = (Model != null ? ((Model.HoLot ?? "") + " " + (Model.TenNV ?? "")).Trim() : "");
    if (string.IsNullOrWhiteSpace(fullName) && Model != null)
    {
        fullName = Model.MaNV;
    }

    string initials = "";
    if (!string.IsNullOrWhiteSpace(Model?.TenNV))
    {
        initials = Model.TenNV.Substring(0, 1).ToUpper();
    }

    var avatarPath = Url.Content("~/Content/Images/Home/NhanVien/" + (Model?.MaNV ?? "default") + ".jpg");
    var avatarDefault = Url.Content("~/Content/Images/Home/NhanVien/default.jpg");
}

<style>
    .hr-info-page {
        padding: 24px;
        font-family: @fontFamily;
        font-size: @(fontSize);
        color: @mainTextColor;
        background: radial-gradient(circle at top left, rgba(148, 163, 255, 0.16), transparent 60%),
                    radial-gradient(circle at bottom right, rgba(45, 212, 191, 0.14), transparent 55%),
                    @pageBg;
        min-height: calc(100vh - 80px);
    }

    .hr-info-header {
        display: flex;
        align-items: center;
        gap: 18px;
        margin-bottom: 20px;
        flex-wrap: wrap;
    }

    .hr-info-avatar {
        width: 80px;
        height: 80px;
        border-radius: 999px;
        position: relative;
        overflow: hidden;
        flex-shrink: 0;
        border: 2px solid rgba(248, 250, 252, 0.6);
        box-shadow: 0 0 16px rgba(15, 23, 42, 0.7);
        background: radial-gradient(circle at 30% 20%, #ffffff 0, #d1d5db 40%, #6b7280 100%);
    }

    .hr-info-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
    }

    .hr-info-avatar-initials {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 28px;
        color: #111827;
        text-shadow: 0 2px 6px rgba(0,0,0,0.45);
        pointer-events: none;
    }

    .hr-info-title-block {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .hr-info-name {
        font-size: 26px;
        font-weight: 700;
        letter-spacing: 0.03em;
        text-transform: uppercase;
        color: @themeColor;
    }

    .hr-info-meta-line {
        font-size: 14px;
        color: @subTextColor;
    }

    .hr-tag-list {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 4px;
    }

    .hr-tag {
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: .08em;
        border: 1px solid rgba(148,163,184,.5);
        background: rgba(15,23,42,0.3);
        color: @lightText;
    }

    .hr-tag-primary {
        border-color: @themeColor;
        color: @themeColor;
        background: rgba(37,99,235,0.08);
    }

    .hr-info-grid {
        margin-top: 12px;
        display: grid;
        grid-template-columns: minmax(0, 4fr) minmax(0, 6fr);
        gap: 18px;
    }

    @@media (max-width: 992px) {
        .hr-info-grid {
            grid-template-columns: minmax(0, 1fr);
        }
    }

    .hr-info-card {
        background: @cardBg;
        border-radius: 18px;
        border: 1px solid @borderColor;
        padding: 16px 18px;
        box-shadow: 0 18px 40px rgba(15,23,42,0.35);
        position: relative;
        overflow: hidden;
    }

    .hr-info-card::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at top left, rgba(255,255,255,0.08), transparent 55%);
        pointer-events: none;
    }

    .hr-info-card-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
    }

    .hr-info-card-title {
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: .09em;
        font-weight: 600;
        color: @themeColor;
    }

    .hr-info-card-note {
        font-size: 12px;
        color: @subTextColor;
    }

    .hr-info-rows {
        margin-top: 8px;
        position: relative;
        z-index: 1;
    }

    .hr-info-row {
        display: grid;
        grid-template-columns: minmax(0, 40%) minmax(0, 60%);
        padding: 6px 0;
        font-size: 13px;
        border-bottom: 1px dashed rgba(148, 163, 184, 0.28);
    }

    .hr-info-row:last-child {
        border-bottom: none;
    }

    .hr-info-label {
        color: @subTextColor;
        padding-right: 10px;
    }

    .hr-info-value {
        color: @mainTextColor;
        word-wrap: break-word;
    }

    .hr-pill-soft {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 8px;
        border-radius: 999px;
        background: rgba(15,23,42,0.6);
        border: 1px solid rgba(148,163,184,.4);
        font-size: 11px;
        color: @lightText;
    }

    .hr-pill-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: @themeColor;
    }

    .hr-link-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid rgba(252,211,77,0.9);
        background: linear-gradient(135deg, #fef3c7, #facc15);
        color: #111827;
        font-size: 13px;
        font-weight: 600;
        text-decoration: none;
        cursor: pointer;
        box-shadow: 0 0 18px rgba(250,204,21,0.35);
        transition: transform .2s, box-shadow .2s;
        margin-right: 8px;
        margin-top: 6px;
    }

    .hr-link-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 0 24px rgba(250,204,21,0.55);
    }

    .hr-link-btn-secondary {
        background: transparent;
        color: @themeColor;
        border-color: @themeColor;
        box-shadow: none;
    }

    .hr-link-btn-secondary:hover {
        background: rgba(37,99,235,0.08);
    }

    .hr-info-two-col {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 12px;
        margin-top: 8px;
    }

    @@media (max-width: 768px) {
        .hr-info-two-col {
            grid-template-columns: minmax(0, 1fr);
        }
    }

    .hr-stat-chip {
        display: flex;
        flex-direction: column;
        padding: 10px 12px;
        border-radius: 14px;
        border: 1px solid rgba(148,163,184,.4);
        background: rgba(15,23,42,0.55);
        font-size: 12px;
        color: @lightText;
    }

    .hr-stat-chip-value {
        font-size: 18px;
        font-weight: 600;
        color: @themeColor;
        margin-top: 2px;
    }

    .hr-info-right-scroll {
        max-height: 520px;
        overflow-y: auto;
        padding-right: 4px;
    }

    .hr-info-right-scroll::-webkit-scrollbar {
        width: 8px;
    }

    .hr-info-right-scroll::-webkit-scrollbar-track {
        background: rgba(15,23,42,0.5);
        border-radius: 999px;
    }

    .hr-info-right-scroll::-webkit-scrollbar-thumb {
        border-radius: 999px;
        background-image: linear-gradient(180deg, rgba(248,250,252,0.9), @themeColor);
    }

    .hr-info-right-scroll::-webkit-scrollbar-thumb:hover {
        filter: brightness(1.1);
    }

    .hr-copy-btn {
        border: none;
        background: transparent;
        color: @subTextColor;
        cursor: pointer;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: .1em;
        margin-left: 10px;
    }

    .hr-copy-btn:hover {
        color: @themeColor;
    }

    .hr-toast {
        position: fixed;
        right: 24px;
        bottom: -60px;
        padding: 10px 14px;
        background: rgba(15,23,42,0.92);
        border-radius: 999px;
        border: 1px solid @themeColor;
        color: #e5e7eb;
        font-size: 13px;
        box-shadow: 0 12px 30px rgba(15,23,42,0.6);
        opacity: 0;
        transition: all .3s ease;
        z-index: 9999;
    }

    .hr-toast.show {
        bottom: 24px;
        opacity: 1;
    }
</style>

<div class="hr-info-page">
    <div class="hr-info-header">
        <div class="hr-info-avatar">
            <img src="@avatarPath"
                 alt="@fullName"
                 onerror="this.onerror=null;this.src='@avatarDefault';" />
            <div class="hr-info-avatar-initials">@initials</div>
        </div>

        <div class="hr-info-title-block">
            <div class="hr-info-name">@fullName</div>
            <div class="hr-info-meta-line">
                @Model.MaNV
                <button type="button"
                        class="hr-copy-btn"
                        data-copy="@Model.MaNV">
                    COPY ID
                </button>
            </div>
            <div class="hr-tag-list">
                <span class="hr-tag hr-tag-primary">@Model.TenPhongBan</span>
                <span class="hr-tag">@Model.TenChucVu</span>
                <span class="hr-tag">
                    @(Model.GioiTinh ? "Nam" : "Nữ")
                    &nbsp;•&nbsp;
                    @Model.NamSinh
                </span>
            </div>
        </div>
    </div>

    <div class="hr-info-grid">
        <!-- LEFT SIDE -->
        <div class="hr-info-left">
            <div class="hr-info-card">
                <div class="hr-info-card-header">
                    <div class="hr-info-card-title">THÔNG TIN CÁ NHÂN</div>
                    <div class="hr-info-card-note">Thông tin cơ bản của nhân viên</div>
                </div>

                <div class="hr-info-rows">
                    <div class="hr-info-row">
                        <div class="hr-info-label">Mã nhân viên</div>
                        <div class="hr-info-value">@Model.MaNV</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Họ và tên</div>
                        <div class="hr-info-value">@fullName</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Giới tính</div>
                        <div class="hr-info-value">
                            @(Model.GioiTinh ? "Nam" : "Nữ")
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Năm sinh</div>
                        <div class="hr-info-value">
                            @Model.NamSinh
                            @if (Model.Tuoi.HasValue)
                            {
                                <span style="color:@subTextColor;">(@Model.Tuoi tuổi)</span>
                            }
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Quê quán</div>
                        <div class="hr-info-value">@Model.QueQuanText</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Ngày vào làm</div>
                        <div class="hr-info-value">
                            @(Model.NgayBatDau.HasValue
                                ? Model.NgayBatDau.Value.ToString("dd/MM/yyyy")
                                : "-")
                        </div>
                    </div>
                </div>
            </div>

            <div class="hr-info-card" style="margin-top:16px;">
                <div class="hr-info-card-header">
                    <div class="hr-info-card-title">LIÊN HỆ</div>
                    <div class="hr-info-card-note">Thông tin liên lạc hiện tại</div>
                </div>

                <div class="hr-info-rows">
                    <div class="hr-info-row">
                        <div class="hr-info-label">Số điện thoại</div>
                        <div class="hr-info-value">@Model.SDT</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Email</div>
                        <div class="hr-info-value">@Model.Email</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Địa chỉ</div>
                        <div class="hr-info-value">@Model.DiaChi</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Facebook</div>
                        <div class="hr-info-value">
                            @if (!string.IsNullOrWhiteSpace(Model.Facebook))
                            {
                                <a href="@Model.Facebook" target="_blank" style="color:@themeColor;text-decoration:underline;">
                                    @Model.Facebook
                                </a>
                            }
                            else
                            {
                                @:-
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="hr-info-card" style="margin-top:16px;">
                <div class="hr-info-card-header">
                    <div class="hr-info-card-title">THỐNG KÊ NHANH</div>
                    <div class="hr-info-card-note">Dựa trên chấm công & thưởng phạt</div>
                </div>

                <div class="hr-info-two-col">
                    <div class="hr-stat-chip">
                        <span>Tổng ca 3 tháng gần nhất</span>
                        <span class="hr-stat-chip-value">
                            @(Model.TongCa3Thang?.ToString("0.##") ?? "0") ca
                        </span>
                    </div>
                    <div class="hr-stat-chip">
                        <span>Thưởng / Phạt</span>
                        <span class="hr-stat-chip-value">
                            @(Model.TongThuong?.ToString("#,0") ?? "0") / @(Model.TongPhat?.ToString("#,0") ?? "0")
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- RIGHT SIDE -->
        <div class="hr-info-card hr-info-right-scroll">
            <div class="hr-info-card-header">
                <div class="hr-info-card-title">PHÒNG BAN & VỊ TRÍ</div>
                <div class="hr-info-card-note">Thông tin tổ chức & doanh nghiệp</div>
            </div>

            <div class="hr-info-rows">
                <div class="hr-info-row">
                    <div class="hr-info-label">Phòng ban</div>
                    <div class="hr-info-value">@Model.TenPhongBan (@Model.MaPB)</div>
                </div>
                <div class="hr-info-row">
                    <div class="hr-info-label">Chức vụ</div>
                    <div class="hr-info-value">@Model.TenChucVu (@Model.MaCV)</div>
                </div>
                <div class="hr-info-row">
                    <div class="hr-info-label">Doanh nghiệp</div>
                    <div class="hr-info-value">@Model.TenDoanhNghiep (@Model.MaDN)</div>
                </div>
                <div class="hr-info-row">
                    <div class="hr-info-label">Địa chỉ DN</div>
                    <div class="hr-info-value">@Model.DiaChiDoanhNghiep</div>
                </div>
            </div>

            <!-- Lương & hợp đồng -->
            <div style="margin-top:18px;">
                <div class="hr-info-card-header">
                    <div class="hr-info-card-title">LƯƠNG & HỢP ĐỒNG</div>
                    <div class="hr-info-card-note">Thông tin lương cơ bản</div>
                </div>

                <div class="hr-info-rows">
                    <div class="hr-info-row">
                        <div class="hr-info-label">Loại nhân viên</div>
                        <div class="hr-info-value">@Model.LoaiNV</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Hệ số lương</div>
                        <div class="hr-info-value">
                            @(Model.HeSoLuong?.ToString("0.##") ?? "-")
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Lương cơ bản</div>
                        <div class="hr-info-value">
                            @(Model.LuongCoBan.HasValue ? Model.LuongCoBan.Value.ToString("#,0") + " VNĐ" : "-")
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Ngày ký HĐLĐ</div>
                        <div class="hr-info-value">
                            @(Model.NgayHDLD.HasValue
                                ? Model.NgayHDLD.Value.ToString("dd/MM/yyyy")
                                : "-")
                        </div>
                    </div>
                </div>
            </div>

            <!-- Người thân -->
            <div style="margin-top:18px;">
                <div class="hr-info-card-header">
                    <div class="hr-info-card-title">NGƯỜI THÂN LIÊN HỆ KHẨN</div>
                    <div class="hr-info-card-note">Lưu trong bảng NHANTHAN</div>
                </div>

                <div class="hr-info-rows">
                    <div class="hr-info-row">
                        <div class="hr-info-label">Họ tên</div>
                        <div class="hr-info-value">@Model.NguoiThanTen</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Quan hệ</div>
                        <div class="hr-info-value">@Model.NguoiThanQuanHe</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Số điện thoại</div>
                        <div class="hr-info-value">@Model.NguoiThanSDT</div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Địa chỉ</div>
                        <div class="hr-info-value">@Model.NguoiThanDiaChi</div>
                    </div>
                </div>
            </div>

            <!-- Sức khoẻ & Bảo hiểm -->
            <div style="margin-top:18px;">
                <div class="hr-info-card-header">
                    <div class="hr-info-card-title">SỨC KHOẺ & BẢO HIỂM</div>
                    <div class="hr-info-card-note">
                        Tóm tắt từ THONGTINSUCKHOE & THONGTINBAOHIEM
                    </div>
                </div>

                <div class="hr-info-rows">
                    <div class="hr-info-row">
                        <div class="hr-info-label">Chiều cao / Cân nặng</div>
                        <div class="hr-info-value">
                            @((Model.ChieuCao.HasValue ? Model.ChieuCao.Value.ToString("0.##") + " cm" : "-"))
                            /
                            @((Model.CanNang.HasValue ? Model.CanNang.Value.ToString("0.##") + " kg" : "-"))
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Tiền sử bệnh</div>
                        <div class="hr-info-value">
                            @(string.IsNullOrWhiteSpace(Model.TienSuBenh) ? "-" : Model.TienSuBenh)
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Thị lực (trên 10)</div>
                        <div class="hr-info-value">
                            @(Model.ThiLucTren10.HasValue ? Model.ThiLucTren10.Value.ToString() : "-")
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Ngày cập nhật SK</div>
                        <div class="hr-info-value">
                            @(Model.NgayCapNhatSucKhoe.HasValue
                                ? Model.NgayCapNhatSucKhoe.Value.ToString("dd/MM/yyyy")
                                : "-")
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Loại bảo hiểm</div>
                        <div class="hr-info-value">
                            @(string.IsNullOrWhiteSpace(Model.LoaiBaoHiem) ? "-" : Model.LoaiBaoHiem)
                        </div>
                    </div>
                    <div class="hr-info-row">
                        <div class="hr-info-label">Số bảo hiểm</div>
                        <div class="hr-info-value">
                            @(string.IsNullOrWhiteSpace(Model.SoBaoHiem) ? "-" : Model.SoBaoHiem)
                        </div>
                    </div>
                    <div class="hr-info-row" style="border-bottom:none;">
                        <div class="hr-info-label">Thời hạn bảo hiểm</div>
                        <div class="hr-info-value">
                            @(Model.ThoiHanBaoHiem.HasValue
                                ? Model.ThoiHanBaoHiem.Value.ToString("dd/MM/yyyy")
                                : "-")
                        </div>
                    </div>
                </div>

                <div class="hr-info-rows" style="margin-top:8px;">
                    <div class="hr-info-row" style="border-bottom:none;">
                        <div class="hr-info-label">Xem chi tiết</div>
                        <div class="hr-info-value">
                            <a href="@Url.Action("Health", "Employee", new { area = "HR", id = Model.MaNV })"
                               class="hr-link-btn">
                                Hồ sơ sức khỏe
                            </a>
                            <a href="@Url.Action("Insurance", "Employee", new { area = "HR", id = Model.MaNV })"
                               class="hr-link-btn hr-link-btn-secondary">
                                Thông tin bảo hiểm
                            </a>
                        </div>
                    </div>
                </div>

                <div style="margin-top:8px;font-size:11px;color:@subTextColor;">
                    Dữ liệu chi tiết chỉnh sửa tại màn hình Sức khoẻ và Bảo hiểm riêng.
                </div>
            </div>
        </div>
    </div>

    <div id="hrToast" class="hr-toast">Đã copy mã nhân viên</div>
</div>

<script>
    (function () {
        var copyBtn = document.querySelector(".hr-copy-btn");
        var toast = document.getElementById("hrToast");

        function showToast(msg) {
            if (!toast) return;
            toast.textContent = msg;
            toast.classList.add("show");
            setTimeout(function () {
                toast.classList.remove("show");
            }, 2200);
        }

        if (copyBtn) {
            copyBtn.addEventListener("click", function () {
                var text = this.getAttribute("data-copy") || "";
                if (!navigator.clipboard) {
                    var temp = document.createElement("textarea");
                    temp.value = text;
                    document.body.appendChild(temp);
                    temp.select();
                    document.execCommand("copy");
                    document.body.removeChild(temp);
                } else {
                    navigator.clipboard.writeText(text);
                }
                showToast("Đã copy mã nhân viên: " + text);
            });
        }
    })();
</script>
