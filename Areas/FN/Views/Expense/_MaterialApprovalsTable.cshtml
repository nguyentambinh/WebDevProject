@model IEnumerable<QLNSVATC.Areas.FN.Data.FN_Models.MaterialPurchaseRowVM>
@using System.Collections.Generic

@{
    string lang = ViewBag.CurrentLang as string ?? "en_US";

    Func<Dictionary<string, string>, string> L = d =>
    {
        if (d.ContainsKey(lang)) return d[lang];
        if (d.ContainsKey("en_US")) return d["en_US"];
        return d.Values.First();
    };

    var tMat = new Dictionary<string, string> {
        { "vi_VN", "Nguyên vật liệu" },
        { "en_US", "Material" },
        { "jp_JP", "原材料" },
        { "kr_KR", "원자재" },
        { "cn_CN", "原材料" }
    };
    var tProject = new Dictionary<string, string> {
        { "vi_VN", "Dự án" },
        { "en_US", "Project" },
        { "jp_JP", "プロジェクト" },
        { "kr_KR", "프로젝트" },
        { "cn_CN", "项目" }
    };
    var tAmount = new Dictionary<string, string> {
        { "vi_VN", "Giá trị" },
        { "en_US", "Amount" },
        { "jp_JP", "金額" },
        { "kr_KR", "금액" },
        { "cn_CN", "金额" }
    };
    var tStatus = new Dictionary<string, string> {
        { "vi_VN", "Trạng thái dự án" },
        { "en_US", "Project status" },
        { "jp_JP", "プロジェクト状態" },
        { "kr_KR", "프로젝트 상태" },
        { "cn_CN", "项目状态" }
    };
    var tFactor = new Dictionary<string, string> {
        { "vi_VN", "Hệ số thay đổi" },
        { "en_US", "Change factor" },
        { "jp_JP", "変動係数" },
        { "kr_KR", "변동 계수" },
        { "cn_CN", "变动系数" }
    };
    var tAction = new Dictionary<string, string> {
        { "vi_VN", "Thao tác" },
        { "en_US", "Action" },
        { "jp_JP", "操作" },
        { "kr_KR", "작업" },
        { "cn_CN", "操作" }
    };
}

<section class="mat-card">
    <div class="mat-card-title-row">
        <h3 class="mat-card-title">
            @L(new Dictionary<string, string>{
                { "vi_VN", "Chi phí nhập nguyên vật liệu" },
                { "en_US", "Raw material purchase costs" },
                { "jp_JP", "原材料仕入れコスト一覧" },
                { "kr_KR", "원자재 구매 비용 목록" },
                { "cn_CN", "原材料采购成本列表" }
            })
        </h3>
    </div>

    <table class="mat-table">
        <thead>
            <tr>
                <th>@L(tMat)</th>
                <th>@L(tProject)</th>
                <th>@L(tAmount)</th>
                <th>@L(tStatus)</th>
                <th>@L(tFactor)</th>
                <th>@L(tAction)</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var row in Model)
            {
                var statusCode = (row.ProjectStatusCode ?? "unknown").ToLower();
                <tr data-code="@row.RequestCode" data-project="@row.ProjectCode">
                    <!-- Nguyên vật liệu -->
                    <td>
                        <div class="mat-owner-cell">
                            <div class="avatar-circle">
                                @((row.MaterialName ?? row.RequestCode ?? "??")
                            .PadRight(2)
                            .Substring(0, 2)
                            .ToUpper())
                            </div>
                            <div class="owner-info">
                                <div class="owner-name">@row.MaterialName</div>
                                <div class="owner-role">
                                    @row.RequestCode
                                </div>
                            </div>
                        </div>
                    </td>

                    <!-- Dự án -->
                    <td>
                        <div class="project-cell">
                            <div class="project-name">@row.ProjectName</div>
                            <div class="project-code">
                                @(string.IsNullOrEmpty(row.ProjectCode)
                            ? "?? \"No project linked\""
                            : row.ProjectCode)
                            </div>
                        </div>
                    </td>

                    <!-- Giá trị -->
                    <td class="mat-amount">
                        @row.Amount.ToString("N0")
                    </td>

                    <!-- Trạng thái dự án -->
                    <td>
                        <span class="mat-status mat-status-@statusCode">
                            @(string.IsNullOrEmpty(row.ProjectStatusCode)
                        ? "-"
                        : row.ProjectStatusCode)
                        </span>
                    </td>

                    <!-- Hệ số thay đổi -->
                    <td class="mat-factor">
                        @(row.ChangeFactor.HasValue
                    ? row.ChangeFactor.Value.ToString("0.##")
                    : "-")
                    </td>

                    <!-- Thao tác: Xem chi tiết + Xóa NVL -->
                    <td class="mat-actions">
                        <button type="button"
                                class="mat-action-btn js-mat-view"
                                title="Xem chi tiết">
                            <i class="fa-regular fa-eye"></i>
                        </button>
                        <button type="button"
                                class="mat-action-btn reject js-mat-delete"
                                title="Xóa phiếu nhập NVL">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
            }
        </tbody>

    </table>
</section>
